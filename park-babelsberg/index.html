<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Park Babelsberg Potsdam – Praktische Infos, Toiletten, Wege & Highlights</title>
<meta name="description" content="Alle praktischen Infos für deinen Besuch: Wo sind Toiletten? Welche Wege sind barrierefrei? Echte Bilder zeigen, was dich erwartet. Für Familien, Senioren, Hundebesitzer.">

<!-- Preload Hero Image for LCP -->
<link rel="preload" href="images/park-babelsberg/jagdschloss.jpeg" as="image" fetchpriority="high">

<!-- SEO Enhancements -->
<meta name="keywords" content="park babelsberg toiletten, wc park babelsberg, restaurants park babelsberg, parkplätze park babelsberg, neuer garten potsdam toiletten, schloss babelsberg gastronomie, potsdam park toiletten finden, park babelsberg karte">
<meta name="geo.region" content="DE-BB">
<meta name="geo.placename" content="Park Babelsberg, Potsdam">
<meta name="geo.position" content="52.400;13.085">
<link rel="canonical" href="https://park.babelsberger.info/">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://park.babelsberger.info/">
<meta property="og:title" content="Parks und Schlösser Potsdam – Park Babelsberg, Neuer Garten & Glienicke">
<meta property="og:description" content="UNESCO-Welterbe Parks in Potsdam: Interaktive Karten mit WCs, Restaurants & Parkplätzen. Location-Finder für Park Babelsberg, Neuer Garten und Park Glienicke.">
<meta property="og:image" content="https://park.babelsberger.info/park-babelsberg/images/park-babelsberg/jagdschloss.jpeg">
<meta property="og:image:width" content="1600">
<meta property="og:image:height" content="900">
<meta property="og:locale" content="de_DE">
<meta property="og:site_name" content="Park Babelsberg Info">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://park.babelsberger.info/">
<meta name="twitter:title" content="Parks und Schlösser Potsdam – Location-Finder">
<meta name="twitter:description" content="UNESCO-Welterbe Parks: WCs, Restaurants & Parkplätze finden mit interaktiver Karte">
<meta name="twitter:image" content="https://park.babelsberger.info/park-babelsberg/images/park-babelsberg/jagdschloss.jpeg">

<link rel="stylesheet" href="assets/style.css">

<!-- Preconnect for faster Ad loading -->
<link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
<link rel="preconnect" href="https://googleads.g.doubleclick.net" crossorigin>

<!-- DSGVO-konformes Cookie-Consent-Management -->
<!-- Google Analytics und AdSense werden nur nach Einwilligung geladen -->
<script src="assets/cookie-consent.js"></script>

<!-- Schema.org JSON-LD for Location Finder -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TouristAttraction",
  "name": "Park Babelsberg",
  "description": "Historischer Landschaftspark in Potsdam mit Location-Finder für WCs, Restaurants und Parkplätze",
  "url": "https://park.babelsberger.info/park-babelsberg/index.html",
  "image": "https://park.babelsberger.info/park-babelsberg/images/park-babelsberg/jagdschloss.jpeg",
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "52.400",
    "longitude": "13.085"
  },
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Potsdam",
    "addressRegion": "Brandenburg",
    "addressCountry": "DE"
  },
  "amenityFeature": [
    {
      "@type": "LocationFeatureSpecification",
      "name": "WC-Finder",
      "value": "Interaktive Karte mit allen öffentlichen Toiletten im Park"
    },
    {
      "@type": "LocationFeatureSpecification",
      "name": "Gastronomie-Finder",
      "value": "Restaurants, Cafés und Imbisse in der Umgebung"
    },
    {
      "@type": "LocationFeatureSpecification",
      "name": "Parkplatz-Finder",
      "value": "Parkplätze für PKW und Fahrräder"
    }
  ],
  "hasMap": {
    "@type": "Map",
    "name": "Park Babelsberg Location-Finder",
    "url": "https://park.babelsberger.info/park-babelsberg/index.html#location-finder",
    "mapType": "VenueMap"
  }
}
</script>

</head>
<body>
<header class="header">
  <div class="hero" style="position: relative; overflow: hidden; border-radius: var(--radius-xl, 16px);">
    <img src="images/park-babelsberg/jagdschloss.jpeg"
         alt="Park Babelsberg mit Blick aufs Jagdschloss Glienicke"
         width="1600"
         height="900"
         fetchpriority="high"
         decoding="async"
         style="width: 100%; height: auto; display: block; object-fit: cover; min-height: 400px;">
    <h1 style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; font-size: clamp(2.5rem, 6vw, 4.5rem); line-height: 1.1; text-shadow: 0 4px 12px rgba(0,0,0,0.6); z-index: 2; width: 90%; max-width: 1200px;">
      Parks und Schlösser in Potsdam-Babelsberg
      <span style="font-size: clamp(1.25rem, 3vw, 2rem); display: block; margin-top: 1rem; text-shadow: 0 2px 8px rgba(0,0,0,0.7);">Kultur, Natur und Erholung am Ufer der Havel</span>
    </h1>
    <div style="position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.4) 100%); z-index: 1;"></div>
  </div>
  <p class="lead">Entdecken Sie die UNESCO-Welterbe-Parks und Kulturdenkmäler am Ufer der Havel. Mit praktischen Informationen zu Örtlichkeiten, Anfahrt und aktuellen Gegebenheiten vor Ort.</p>
  <nav class="nav" aria-label="Sprungmarken">
    <div class="badges">
      <a class="badge" href="#areale">Die 4 Areale</a>
      <a class="badge" href="#location-finder">Location-Finder</a>
      <a class="badge" href="#kategorien">Kategorien</a>
      <a class="badge" href="#anreise">Anreise</a>
      <a class="badge" href="#faq">FAQ</a>
    </div>
  </nav>
</header>

<main id="content" data-page="park-babelsberg" data-date="2025-10-25">

  <!-- Die 4 Areale - Unified Card Grid -->
  <section id="areale" class="section">
    <div class="section-header">
      <h2>Die 4 Areale – Eine Landschaft, vier Erlebnisse</h2>
      <p>Von der historischen Parkanlage bis zum königlichen Schloss – entdecke die verbundenen UNESCO-Welterbe-Areale am Ufer der Havel.</p>
    </div>

    <div class="grid-2">
      <!-- Areal 1: Park Babelsberg -->
      <article class="card-areal">
        <img src="images/park-babelsberg/Uferweg_nord.jpeg" alt="Park Babelsberg - Uferweg Nord mit Panoramablick" loading="lazy">
        <div class="card-areal-content">
          <span class="card-areal-label">Areal 1</span>
          <h3>Park Babelsberg</h3>
          <p>Der 124 Hektar große englische Landschaftspark am Ufer der Havel ist ein Meisterwerk der Gartenkunst. Seit 1990 UNESCO-Welterbe.</p>
          <div class="card-areal-highlights">
            <strong>Besondere Highlights:</strong>
            <ul>
              <li>→ <a href="/park-babelsberg/uferweg-nord.html">Uferweg Nord</a> – Panoramablick über den Tiefen See</li>
              <li>→ <a href="/park-babelsberg/flatowturm.html">Flatowturm</a> – 46m Aussichtsturm mit 360°-Blick</li>
              <li>→ <a href="/park-babelsberg/matrosenhaus.html">Matrosenhaus</a> – Historisches Bootshaus</li>
            </ul>
          </div>
          <a href="/park-babelsberg/park-babelsberg.html" class="btn">Mehr erfahren</a>
        </div>
      </article>

      <!-- Areal 2: Schloss Babelsberg -->
      <article class="card-areal">
        <img src="images/park-babelsberg/schloss_garten.jpeg" alt="Schloss Babelsberg Garten" loading="lazy">
        <div class="card-areal-content">
          <span class="card-areal-label">Areal 2</span>
          <h3>Schloss Babelsberg</h3>
          <p>Das neugotische Sommerschloss von Kaiser Wilhelm I. thront majestätisch über der Havel. Erbaut 1833-1849 nach Entwürfen von Karl Friedrich Schinkel.</p>
          <div class="card-areal-highlights">
            <strong>Besondere Highlights:</strong>
            <ul>
              <li>→ <a href="/park-babelsberg/schloss-babelsberg.html">Schloss Babelsberg</a> – Neugotische Architektur</li>
              <li>→ Schlosspark – Terrassengärten mit Aussicht</li>
              <li>→ Zypressen-Allee – Beeindruckende Baumallee</li>
            </ul>
          </div>
          <a href="/park-babelsberg/schloss-babelsberg.html" class="btn">Mehr erfahren</a>
        </div>
      </article>

      <!-- Areal 3: Neuer Garten -->
      <article class="card-areal">
        <img src="images/park-babelsberg/cicilienhof.jpeg" alt="Schloss Cecilienhof im Neuen Garten" loading="lazy">
        <div class="card-areal-content">
          <span class="card-areal-label">Areal 3</span>
          <h3>Neuer Garten</h3>
          <p>Ein frühes Meisterwerk der Landschaftsgestaltung am Heiligen See. Angelegt ab 1787 für Friedrich Wilhelm II. Hier fand 1945 die Potsdamer Konferenz statt.</p>
          <div class="card-areal-highlights">
            <strong>Besondere Highlights:</strong>
            <ul>
              <li>→ Schloss Cecilienhof – Ort der Potsdamer Konferenz 1945</li>
              <li>→ Marmorpalais – Frühklassizistisches Schloss am See</li>
              <li>→ Heiliger See – Idyllischer Rundweg mit Badestellen</li>
            </ul>
          </div>
          <a href="/park-babelsberg/neuer-garten.html" class="btn">Mehr erfahren</a>
        </div>
      </article>

      <!-- Areal 4: Park Glienicke -->
      <article class="card-areal">
        <img src="images/park-babelsberg/jagdschloss.jpeg" alt="Jagdschloss Glienicke" loading="lazy">
        <div class="card-areal-content">
          <span class="card-areal-label">Areal 4</span>
          <h3>Park Glienicke</h3>
          <p>Der südlichste Teil der UNESCO-Welterbe-Landschaft an der Glienicker Brücke. Ein verstecktes Juwel mit italienisch inspirierter Architektur.</p>
          <div class="card-areal-highlights">
            <strong>Besondere Highlights:</strong>
            <ul>
              <li>→ Jagdschloss Glienicke – Klassizistisches Kleinod am Wasser</li>
              <li>→ Glienicker Brücke – Historische "Agentenbrücke"</li>
              <li>→ Parklandschaft – Italienisch inspirierte Gartenkunst</li>
            </ul>
          </div>
          <a href="/park-babelsberg/park-glienicke.html" class="btn">Mehr erfahren</a>
        </div>
      </article>
    </div>
  </section>

  <!-- Location Finder - Moved up for better accessibility -->
  <section id="location-finder" class="section" style="background: var(--bg-accent); padding: var(--space-8) var(--container-padding); margin-left: calc(var(--container-padding) * -1); margin-right: calc(var(--container-padding) * -1);">
    <div style="max-width: var(--container-max); margin: 0 auto;">
      <div class="section-header">
        <h2>Finde was du brauchst</h2>
        <p>Interaktive Karte mit WCs, Restaurants, Parkplätzen und ÖPNV-Haltestellen. Mit Standort-Navigation und Live-Fahrplanauskünften.</p>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <!-- Main Filter Buttons -->
        <div style="padding:16px;display:flex;gap:12px;flex-wrap:wrap;background:var(--bg-secondary);border-bottom:2px solid var(--border-light);">
          <button id="filter-wc" class="filter-btn active" data-layer="wc" aria-pressed="true">
            <span class="filter-icon">🚻</span> WC <span class="filter-count" id="count-wc">0</span>
          </button>
          <button id="filter-gastro" class="filter-btn active" data-layer="gastro" aria-pressed="true">
            <span class="filter-icon">🍽️</span> Gastronomie <span class="filter-count" id="count-gastro">0</span>
          </button>
          <button id="filter-parking" class="filter-btn" data-layer="parking" aria-pressed="false">
            <span class="filter-icon">🅿️</span> Parkplätze <span class="filter-count" id="count-parking">0</span>
          </button>
          <button id="filter-oepnv" class="filter-btn" data-layer="oepnv" aria-pressed="false">
            <span class="filter-icon">🚍</span> ÖPNV <span class="filter-count" id="count-oepnv">0</span>
          </button>
        </div>

        <!-- Sub-Filter für Gastronomie -->
        <div id="gastro-subfilter" class="subfilter-panel">
          <div style="padding:12px 16px;display:flex;gap:8px;flex-wrap:wrap;background:#fafafa;">
            <label class="subfilter-checkbox">
              <input type="checkbox" data-amenity="restaurant" checked> 🍽️ Restaurant
            </label>
            <label class="subfilter-checkbox">
              <input type="checkbox" data-amenity="cafe" checked> ☕ Café
            </label>
            <label class="subfilter-checkbox">
              <input type="checkbox" data-amenity="fast_food" checked> 🍔 Imbiss
            </label>
            <label class="subfilter-checkbox">
              <input type="checkbox" data-amenity="bar" checked> 🍺 Bar
            </label>
            <label class="subfilter-checkbox">
              <input type="checkbox" data-amenity="pub" checked> 🍺 Pub
            </label>
            <label class="subfilter-checkbox">
              <input type="checkbox" data-amenity="ice_cream" checked> 🍦 Eiscafé
            </label>
            <label class="subfilter-checkbox">
              <input type="checkbox" data-amenity="biergarten" checked> 🌳 Biergarten
            </label>
          </div>
        </div>

        <!-- Map Container -->
        <div id="unified-map" style="height:500px;width:100%;background:#e5e7eb;" role="application" aria-label="Interaktive Karte"></div>

        <!-- Controls -->
        <div style="padding:16px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;background:white;">
          <button id="btn-locate" class="map-btn map-btn-primary" aria-label="Meinen Standort nutzen">
            📍 Standort nutzen
          </button>
          <button id="btn-nearest-wc" class="map-btn map-btn-secondary" disabled aria-label="Zum nächsten WC navigieren">
            🚻 Nächstes WC
          </button>
          <button id="btn-nearest-gastro" class="map-btn map-btn-secondary" disabled aria-label="Zum nächsten Restaurant navigieren">
            🍽️ Nächstes Restaurant
          </button>
          <button id="btn-nearest-parking" class="map-btn map-btn-secondary" disabled style="display:none;" aria-label="Zum nächsten Parkplatz navigieren">
            🅿️ Nächster Parkplatz
          </button>
        </div>

        <!-- Distance Info -->
        <div id="distance-info" style="padding:0 16px 12px;color:var(--text-muted);font-size:0.9rem;min-height:20px;" role="status" aria-live="polite"></div>

        <!-- Legend -->
        <details class="notice" style="margin:0 16px 16px;cursor:pointer;">
          <summary style="font-weight:600;padding:8px 0;">📍 Legende & Datenquellen</summary>
          <div style="padding-top:8px;font-size:0.9rem;line-height:1.6;">
            <strong>WC:</strong> 🟢 Öffentlich · 🟡 Nur Kunden · 💰 Kostenpflichtig<br>
            <strong>Gastronomie:</strong> 🍽️ Restaurant · ☕ Café · 🍔 Imbiss · 🍺 Bar/Pub · 🍦 Eiscafé · 🌳 Biergarten<br>
            <strong>Parkplätze:</strong> 🅿️ Öffentlich · 💰 Kostenpflichtig · 🔒 Privat · 🏢 Parkhaus · 🚲 Fahrrad<br>
            <strong>ÖPNV:</strong> 🚍 Bus & Tram Haltestellen · 🕐 Fahrplanauskünfte via VBB<br>
            <strong>Daten:</strong> © OpenStreetMap-Mitwirkende (ODbL) ·
            <strong>Navigation:</strong> Google Maps
          </div>
        </details>
      </div>
    </div>
  </section>

  <!-- AdSense Ad Unit 1 -->
  <section class="section" style="padding: var(--space-4) 0;">
    <div style="max-width: 728px; margin: 0 auto;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-1712273263687132"
           data-ad-slot="4436722440"
           data-ad-format="horizontal"
           data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </section>

  <!-- Kategorien-Übersicht - New consolidated section -->
  <section id="kategorien" class="section">
    <div class="section-header">
      <h2>Entdecke nach Kategorien</h2>
      <p>Finde schnell was du suchst – von Sehenswürdigkeiten bis zu praktischen Services.</p>
    </div>

    <div class="grid-3">
      <article class="card-category">
        <div class="card-category-icon">🏰</div>
        <h3>Schlösser & Bauwerke</h3>
        <p class="card-category-count">8 historische Orte</p>
        <p>Neugotische Schlösser, Aussichtstürme und historische Bauwerke aus verschiedenen Epochen.</p>
        <a href="#highlights" class="btn">Alle ansehen</a>
      </article>

      <article class="card-category">
        <div class="card-category-icon">🍽️</div>
        <h3>Gastronomie</h3>
        <p class="card-category-count">303 Locations</p>
        <p>Restaurants, Cafés, Imbisse und Biergärten in Fußnähe zum Park.</p>
        <a href="/park-babelsberg/gastronomie.html" class="btn">Alle ansehen</a>
      </article>

      <article class="card-category">
        <div class="card-category-icon">🚻</div>
        <h3>Praktisches</h3>
        <p class="card-category-count">WC, Parking, ÖPNV</p>
        <p>Toiletten, Parkplätze und öffentliche Verkehrsmittel mit Live-Daten.</p>
        <a href="#location-finder" class="btn">Auf Karte zeigen</a>
      </article>

      <article class="card-category">
        <div class="card-category-icon">🌳</div>
        <h3>Natur & Wege</h3>
        <p class="card-category-count">Spazierwege & Wiesen</p>
        <p>Malerische Uferwege, Liegewiesen und Naturerlebnisse im Park.</p>
        <a href="/park-babelsberg/uferweg-nord.html" class="btn">Entdecken</a>
      </article>

      <article class="card-category">
        <div class="card-category-icon">🚗</div>
        <h3>Anreise & Parken</h3>
        <p class="card-category-count">1200+ Parkplätze</p>
        <p>Alle Infos zu Anfahrt, Parkplätzen und öffentlichen Verkehrsmitteln.</p>
        <a href="#anreise" class="btn">Mehr erfahren</a>
      </article>

      <article class="card-category">
        <div class="card-category-icon">📋</div>
        <h3>Regeln & Ordnung</h3>
        <p class="card-category-count">Parkordnung</p>
        <p>Was ist erlaubt? Radfahren, Picknicken, Baden und mehr.</p>
        <a href="/park-babelsberg/parkordnung-vergleich.html" class="btn">Vergleich ansehen</a>
      </article>
    </div>
  </section>

  <!-- AdSense Ad Unit 2 -->
  <section class="section" style="padding: var(--space-4) 0;">
    <div style="max-width: 728px; margin: 0 auto;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-1712273263687132"
           data-ad-slot="4436722440"
           data-ad-format="horizontal"
           data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </section>

  <!-- Highlights - Consolidated to 4 key locations -->
  <section id="highlights" class="section">
    <div class="section-header">
      <h2>Die schönsten Orte</h2>
      <p>Entdecke die historischen Bauwerke und landschaftlichen Highlights im UNESCO-Welterbe Park Babelsberg.</p>
    </div>

    <div class="grid-2">
      <article class="card">
        <img src="images/park-babelsberg/attractions/schloss-babelsberg-1.webp" alt="Schloss Babelsberg" loading="lazy">
        <h3>Schloss Babelsberg</h3>
        <p>Neugotisches Sommerschloss von Kaiser Wilhelm I. Erbaut 1833-1849 von Schinkel, Persius und Strack. UNESCO-Welterbe seit 1990.</p>
        <a href="/park-babelsberg/schloss-babelsberg.html" class="btn">Mehr erfahren</a>
      </article>

      <article class="card">
        <img src="images/park-babelsberg/attractions/flatowturm-1.webp" alt="Flatowturm" loading="lazy">
        <h3>Flatowturm</h3>
        <p>46m hoher Aussichtsturm mit 360°-Panorama über Potsdam. Erbaut 1853-1856. Geöffnet Mai–Oktober, Sa/So 10-17:30 Uhr.</p>
        <a href="/park-babelsberg/flatowturm.html" class="btn">Mehr erfahren</a>
      </article>

      <article class="card">
        <img src="images/park-babelsberg/Uferweg_nord.jpeg" alt="Uferweg Nord – Blick über den Tiefen See" loading="lazy">
        <h3>Uferweg Nord</h3>
        <p>Malerischer Spazierweg mit freiem Panoramablick über den Tiefen See. Perfekt zum Entspannen, Fotografieren und Sonnenuntergang genießen.</p>
        <a href="uferweg-nord.html" class="btn">Mehr erfahren</a>
      </article>

      <article class="card">
        <img src="images/park-babelsberg/attractions/matrosenhaus-1.webp" alt="Matrosenhaus" loading="lazy">
        <h3>Matrosenhaus</h3>
        <p>Historisches Bootshaus am Havelufer aus dem 19. Jahrhundert. Heute Event-Location mit romantischem Blick aufs Wasser.</p>
        <a href="/park-babelsberg/matrosenhaus.html" class="btn">Mehr erfahren</a>
      </article>
    </div>
  </section>

  <!-- Anreise & Parkplätze - Simplified -->
  <section id="anreise" class="section" style="background: var(--bg-tertiary); padding: var(--space-8) var(--container-padding); margin-left: calc(var(--container-padding) * -1); margin-right: calc(var(--container-padding) * -1);">
    <div style="max-width: var(--container-max); margin: 0 auto;">
      <div class="section-header">
        <h2>Anreise & Parkplätze</h2>
        <p>So kommst du am besten zum Park Babelsberg – mit Auto, ÖPNV oder Fahrrad.</p>
      </div>

      <div class="grid-2">
        <article class="card">
          <h3>🚗 Mit dem Auto</h3>
          <p>
            <strong>Hauptparkplatz "Am Neuen Garten"</strong><br>
            GPS: 52.419083, 13.071547<br>
            Kapazität: ca. 50 Stellplätze<br>
            Entfernung zum Schloss: 1,2 km (15 Min. Fußweg)
          </p>
          <p style="margin-top:12px;color:var(--text-muted);">
            <strong style="color:var(--warning);">An Wochenenden oft voll ab 11 Uhr</strong> – früh kommen empfohlen!
          </p>
          <a href="#location-finder" class="btn" onclick="setTimeout(() => { document.getElementById('filter-parking').click(); }, 100);">Alle Parkplätze auf Karte</a>
        </article>

        <article class="card">
          <h3>🚌 Mit ÖPNV (Empfohlen!)</h3>
          <p>
            <strong>Bus 694:</strong> Haltestelle "Park Babelsberg" (direkt am Eingang)<br>
            <strong>Bus 690:</strong> Haltestelle "Rathaus Babelsberg" (800m Fußweg)<br>
            <strong>Tram 93:</strong> Haltestelle "Lutherplatz" (1,2 km Fußweg)
          </p>
          <p style="margin-top:12px;color:var(--text-muted);">
            <strong style="color:var(--success);">Klimafreundlich und stressfrei</strong> – keine Parkplatzsuche!
            Live-Abfahrtszeiten auf unserer Karte verfügbar.
          </p>
          <a href="#location-finder" class="btn" onclick="setTimeout(() => { document.getElementById('filter-oepnv').click(); }, 100);">Live-Fahrplan</a>
        </article>
      </div>

      <div class="notice" style="margin-top:var(--space-4);">
        <h3 style="margin-top:0;">💡 Parktipps für Autofahrer</h3>
        <p style="margin:0 0 12px 0;">
          <strong>Tipp 1:</strong> Wochenend-Besucher sollten vor 10 Uhr anreisen oder auf ÖPNV umsteigen.
        </p>
        <p style="margin:0 0 12px 0;">
          <strong>Tipp 2:</strong> Über 1200 weitere Parkplätze in der Umgebung (siehe Karte oben).
        </p>
        <p style="margin:0;">
          <strong>Tipp 3:</strong> Park + Ride: Parkplatz am S-Bahnhof Griebnitzsee (kostenlos), dann 15 Min. Fußweg.
        </p>
      </div>
    </div>
  </section>

  <!-- FAQ Section - New -->
  <section id="faq" class="section">
    <div class="section-header">
      <h2>Häufig gestellte Fragen</h2>
      <p>Schnelle Antworten auf die wichtigsten Fragen rund um deinen Besuch.</p>
    </div>

    <details class="faq-item">
      <summary>Wo finde ich Toiletten im Park?</summary>
      <div class="faq-item-content">
        <p>Öffentliche WCs sind an den Haupteingängen ausgeschildert. Nutze unseren <a href="#location-finder">Location-Finder</a> um die nächste Toilette zu finden. Einige sind kostenpflichtig (ca. 0,50€), andere kostenlos.</p>
      </div>
    </details>

    <details class="faq-item">
      <summary>Ist der Park barrierefrei?</summary>
      <div class="faq-item-content">
        <p>Die asphaltierten Hauptwege sind gut befahrbar für Rollstühle und Kinderwagen. Einige Naturwege haben Steigungen und sind weniger geeignet. Der Flatowturm ist nicht barrierefrei (nur über Treppen erreichbar).</p>
      </div>
    </details>

    <details class="faq-item">
      <summary>Darf ich im Park grillen oder picknicken?</summary>
      <div class="faq-item-content">
        <p>Picknicken ist auf den Liegewiesen erlaubt. Grillen ist im gesamten Park verboten (Brandschutz). Bitte Müll mitnehmen oder in den bereitgestellten Abfallbehältern entsorgen.</p>
      </div>
    </details>

    <details class="faq-item">
      <summary>Kann ich mit dem Fahrrad durch den Park fahren?</summary>
      <div class="faq-item-content">
        <p>Radfahren ist nur auf den asphaltierten Hauptwegen erlaubt. Auf Wanderwegen und Naturpfaden ist Radfahren verboten. Schilder vor Ort beachten. Mehr Details in unserer <a href="/park-babelsberg/parkordnung-vergleich.html">Parkordnung</a>.</p>
      </div>
    </details>

    <details class="faq-item">
      <summary>Sind Hunde im Park erlaubt?</summary>
      <div class="faq-item-content">
        <p>Ja, Hunde sind erlaubt, müssen aber an der Leine geführt werden. Hundekotbeutel bitte mitnehmen und in den Abfallbehältern entsorgen.</p>
      </div>
    </details>

    <details class="faq-item">
      <summary>Kann ich in der Havel schwimmen?</summary>
      <div class="faq-item-content">
        <p>Nein, Schwimmen in der Havel ist verboten (keine Badeaufsicht, Strömung, Schiffsverkehr). Alternative Badestellen gibt es am Heiligen See im Neuen Garten.</p>
      </div>
    </details>

    <details class="faq-item">
      <summary>Gibt es Führungen durch den Park?</summary>
      <div class="faq-item-content">
        <p>Ja, die Stiftung Preußische Schlösser und Gärten bietet regelmäßig Führungen an. Termine und Buchung auf <a href="https://www.spsg.de" target="_blank" rel="noopener">www.spsg.de</a>.</p>
      </div>
    </details>

    <details class="faq-item">
      <summary>Wie lange sollte ich für einen Besuch einplanen?</summary>
      <div class="faq-item-content">
        <p>Für einen entspannten Spaziergang: 2-3 Stunden. Mit Schlossbesichtigung und Flatowturm: 4-5 Stunden. Für alle 4 Areale: Ganztagesausflug empfohlen.</p>
      </div>
    </details>
  </section>

</main>

<!-- Footer -->
<footer>
  <p>
    <a href="/park-babelsberg/impressum.html">Impressum</a> ·
    <a href="/park-babelsberg/datenschutz.html">Datenschutz</a> ·
    <a href="#" onclick="window.showCookieBanner(); return false;">Cookie-Einstellungen</a>
  </p>
  <p style="margin-top:var(--space-2);color:var(--text-light);">
    © 2025 Park Babelsberg Info · Daten: OpenStreetMap-Mitwirkende (ODbL)
  </p>
</footer>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">

<!-- Leaflet MarkerCluster CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" crossorigin="anonymous">

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

<!-- Leaflet MarkerCluster JS -->
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js" crossorigin="anonymous"></script>

<!-- Styles -->
<style>
  /* Filter Buttons */
  .filter-btn {
    padding: 10px 16px;
    border: 2px solid #d1d5db;
    border-radius: 8px;
    background: white;
    color: #374151;
    font-family: var(--font-body);
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1 1 auto;
    min-width: 140px;
    justify-content: center;
  }

  .filter-btn .filter-icon {
    font-size: 1.2rem;
  }

  .filter-btn .filter-count {
    background: #e5e7eb;
    color: #6b7280;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 700;
    margin-left: 4px;
  }

  .filter-btn.active {
    border-color: #2563eb;
    background: #2563eb;
    color: white;
    box-shadow: 0 2px 4px rgba(37,99,235,0.3);
  }

  .filter-btn.active .filter-count {
    background: rgba(255,255,255,0.3);
    color: white;
  }

  .filter-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .filter-btn:active {
    transform: translateY(0);
  }

  /* Sub-Filter Panel */
  .subfilter-panel {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    border-bottom: 1px solid #e5e7eb;
  }

  .subfilter-panel.open {
    max-height: 200px;
  }

  .subfilter-checkbox {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
  }

  .subfilter-checkbox:hover {
    border-color: #2563eb;
    background: #eff6ff;
  }

  .subfilter-checkbox input[type="checkbox"] {
    cursor: pointer;
  }

  /* Map Buttons */
  .map-btn {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    font-family: var(--font-body);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    flex: 1 1 auto;
    min-width: 140px;
  }

  .map-btn-primary {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    color: white;
    box-shadow: 0 2px 4px rgba(37,99,235,0.3);
  }

  .map-btn-primary:hover:not(:disabled) {
    box-shadow: 0 4px 12px rgba(37,99,235,0.4);
    transform: translateY(-2px);
  }

  .map-btn-secondary {
    background: white;
    color: #2563eb;
    border: 2px solid #2563eb;
    font-size: 0.85rem;
    padding: 8px 12px;
  }

  .map-btn-secondary:hover:not(:disabled) {
    background: #2563eb;
    color: white;
    transform: translateY(-1px);
  }

  .map-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none !important;
  }

  /* Leaflet Popup Customization */
  .leaflet-popup-content-wrapper {
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    padding: 0;
    overflow: hidden;
  }

  .leaflet-popup-content {
    margin: 0;
    font-family: var(--font-body);
    min-width: 200px;
  }

  .popup-header {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    color: white;
    padding: 12px 16px;
    font-weight: 700;
    font-size: 1rem;
  }

  .popup-body {
    padding: 12px 16px;
    line-height: 1.6;
  }

  .popup-body p {
    margin: 4px 0;
    font-size: 0.9rem;
  }

  .popup-actions {
    padding: 12px 16px;
    background: #f9fafb;
    border-top: 1px solid #e5e7eb;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .popup-btn {
    flex: 1;
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    min-width: 100px;
  }

  .popup-btn-primary {
    background: #2563eb;
    color: white;
  }

  .popup-btn-primary:hover {
    background: #1d4ed8;
    transform: translateY(-1px);
  }

  .popup-btn-secondary {
    background: white;
    color: #2563eb;
    border: 1px solid #2563eb;
  }

  .popup-btn-secondary:hover {
    background: #eff6ff;
  }

  /* Marker Cluster Customization */
  .marker-cluster-small, .marker-cluster-medium, .marker-cluster-large {
    background: rgba(37, 99, 235, 0.6);
  }

  .marker-cluster-small div, .marker-cluster-medium div, .marker-cluster-large div {
    background: rgba(37, 99, 235, 0.8);
    color: white;
    font-weight: 700;
  }

  /* Mobile Optimization */
  @media (max-width: 768px) {
    #unified-map {
      height: 400px;
    }

    .filter-btn {
      font-size: 0.85rem;
      padding: 8px 12px;
      min-width: 110px;
    }

    .filter-btn .filter-icon {
      font-size: 1rem;
    }

    .map-btn {
      font-size: 0.85rem;
      padding: 8px 12px;
      min-width: 110px;
    }

    .subfilter-checkbox {
      font-size: 0.8rem;
      padding: 4px 8px;
    }

    .popup-header {
      font-size: 0.9rem;
      padding: 10px 12px;
    }

    .popup-body p {
      font-size: 0.85rem;
    }

    .popup-btn {
      font-size: 0.8rem;
      padding: 6px 10px;
      min-width: 80px;
    }
  }

  @media (max-width: 480px) {
    #unified-map {
      height: 350px;
    }

    .filter-btn, .map-btn {
      flex: 1 1 100%;
      max-width: none;
    }

    .popup-actions {
      flex-direction: column;
    }

    .popup-btn {
      width: 100%;
    }
  }
</style>

<!-- Map Script -->
<script>
(function() {
  'use strict';

  // Configuration
  const CONFIG = {
    dataPaths: {
      wc: 'data/wc.geojson',
      gastro: 'data/gastronomie.geojson',
      parking: 'data/parking.geojson',
      oepnv: 'data/oepnv.geojson'
    },
    defaultCenter: [52.400, 13.085],
    defaultZoom: 14,
    maxZoom: 19,
    tileLayer: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
    tileAttribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    clusterOptions: {
      maxClusterRadius: 60,
      spiderfyOnMaxZoom: true,
      showCoverageOnHover: false,
      zoomToBoundsOnClick: true
    }
  };

  // Color schemes
  const COLORS = {
    wc: { public: '#10b981', customers: '#f59e0b', paid: '#3b82f6' },
    gastro: {
      restaurant: '#dc2626', cafe: '#92400e', fast_food: '#f59e0b',
      bar: '#7c3aed', pub: '#7c3aed', ice_cream: '#ec4899', biergarten: '#10b981'
    },
    parking: {
      bicycle_parking: '#10b981', public_free: '#3b82f6', public_paid: '#f59e0b',
      private: '#6b7280', 'multi-storey': '#1e3a8a'
    }
  };

  // State
  let map = null;
  let userPos = null;
  let userMarker = null;
  let clusters = {
    wc: L.markerClusterGroup(CONFIG.clusterOptions),
    gastro: L.markerClusterGroup(CONFIG.clusterOptions),
    parking: L.markerClusterGroup(CONFIG.clusterOptions),
    oepnv: L.markerClusterGroup(CONFIG.clusterOptions)
  };
  let data = { wc: [], gastro: [], parking: [], oepnv: [] };
  let activeFilters = { wc: true, gastro: true, parking: false, oepnv: false };
  let gastroSubFilters = {
    restaurant: true, cafe: true, fast_food: true,
    bar: true, pub: true, ice_cream: true, biergarten: true
  };

  // DOM Elements
  const btnLocate = document.getElementById('btn-locate');
  const btnNearestWC = document.getElementById('btn-nearest-wc');
  const btnNearestGastro = document.getElementById('btn-nearest-gastro');
  const btnNearestParking = document.getElementById('btn-nearest-parking');
  const distanceInfo = document.getElementById('distance-info');
  const filterButtons = document.querySelectorAll('.filter-btn');
  const gastroSubfilter = document.getElementById('gastro-subfilter');
  const gastroSubCheckboxes = document.querySelectorAll('.subfilter-checkbox input[type="checkbox"]');

  // Initialize Map
  function initMap() {
    map = L.map('unified-map', {
      center: CONFIG.defaultCenter,
      zoom: CONFIG.defaultZoom,
      maxZoom: CONFIG.maxZoom,
      zoomControl: true
    });

    L.tileLayer(CONFIG.tileLayer, {
      attribution: CONFIG.tileAttribution,
      maxZoom: CONFIG.maxZoom
    }).addTo(map);

    // Add active clusters to map
    updateMapLayers();
  }

  // Update map layers based on active filters
  function updateMapLayers() {
    Object.keys(clusters).forEach(type => {
      if (activeFilters[type]) {
        if (!map.hasLayer(clusters[type])) {
          map.addLayer(clusters[type]);
        }
      } else {
        if (map.hasLayer(clusters[type])) {
          map.removeLayer(clusters[type]);
        }
      }
    });

    // Special handling for gastro subfilters
    if (activeFilters.gastro) {
      updateGastroMarkers();
    }

    // Update button visibility
    if (activeFilters.parking && userPos) {
      btnNearestParking.style.display = 'inline-block';
    } else {
      btnNearestParking.style.display = 'none';
    }
  }

  // Update gastro markers based on subfilters
  function updateGastroMarkers() {
    clusters.gastro.clearLayers();
    data.gastro.forEach(item => {
      if (gastroSubFilters[item.amenity]) {
        const color = COLORS.gastro[item.amenity] || '#6b7280';
        const icon = getGastroIcon(item.amenity);
        const marker = createMarker([item.lat, item.lng], color, icon);
        const popup = createGastroPopup(item.props, item.lat, item.lng);
        marker.bindPopup(popup);
        marker._amenityType = item.amenity;
        clusters.gastro.addLayer(marker);
      }
    });
  }

  // Load all data
  async function loadAllData() {
    try {
      const [wcData, gastroData, parkingData, oepnvData] = await Promise.all([
        fetch(CONFIG.dataPaths.wc).then(r => r.json()),
        fetch(CONFIG.dataPaths.gastro).then(r => r.json()),
        fetch(CONFIG.dataPaths.parking).then(r => r.json()),
        fetch(CONFIG.dataPaths.oepnv).then(r => r.json())
      ]);

      // Process WC data
      wcData.features.forEach(addWCMarker);
      document.getElementById('count-wc').textContent = wcData.features.length;

      // Process Gastro data
      gastroData.features.forEach(addGastroMarker);
      document.getElementById('count-gastro').textContent = gastroData.features.length;

      // Process Parking data
      parkingData.features.forEach(addParkingMarker);
      document.getElementById('count-parking').textContent = parkingData.features.length;

      // Process ÖPNV data
      oepnvData.features.forEach(addOEPNVMarker);
      document.getElementById('count-oepnv').textContent = oepnvData.features.length;

      // Fit bounds
      const bounds = [
        ...data.wc.map(d => [d.lat, d.lng]),
        ...data.gastro.map(d => [d.lat, d.lng])
      ];

      if (bounds.length > 0) {
        map.fitBounds(bounds, { padding: [50, 50], maxZoom: 15 });
      }

    } catch (error) {
      console.error('Fehler beim Laden der Daten:', error);
    }
  }

  // Create marker
  function createMarker(latlng, color, emoji) {
    const icon = L.divIcon({
      className: 'custom-marker',
      html: `<div style="
        width: 32px;
        height: 32px;
        background: ${color};
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      ">${emoji}</div>`,
      iconSize: [32, 32],
      iconAnchor: [16, 16],
      popupAnchor: [0, -16]
    });

    return L.marker(latlng, { icon });
  }

  // Add WC marker
  function addWCMarker(feature) {
    const [lng, lat] = feature.geometry.coordinates;
    const props = feature.properties || {};

    let color = COLORS.wc.public;
    if (props.access === 'customers') color = COLORS.wc.customers;
    else if (props.fee === 'yes') color = COLORS.wc.paid;

    const marker = createMarker([lat, lng], color, '🚻');
    const popup = createWCPopup(props, lat, lng);
    marker.bindPopup(popup);

    clusters.wc.addLayer(marker);
    data.wc.push({ lat, lng, props, type: 'wc' });
  }

  // Add Gastro marker
  function addGastroMarker(feature) {
    const [lng, lat] = feature.geometry.coordinates;
    const props = feature.properties || {};

    const color = COLORS.gastro[props.amenity] || '#6b7280';
    const icon = getGastroIcon(props.amenity);
    const marker = createMarker([lat, lng], color, icon);
    const popup = createGastroPopup(props, lat, lng);
    marker.bindPopup(popup);

    marker._amenityType = props.amenity;
    clusters.gastro.addLayer(marker);
    data.gastro.push({ lat, lng, props, type: 'gastro', amenity: props.amenity });
  }

  // Add Parking marker
  function addParkingMarker(feature) {
    const [lng, lat] = feature.geometry.coordinates;
    const props = feature.properties || {};

    const category = getParkingCategory(props);
    const color = COLORS.parking[category] || '#3b82f6';
    const marker = createMarker([lat, lng], color, '🅿️');
    const popup = createParkingPopup(props, lat, lng);
    marker.bindPopup(popup);

    clusters.parking.addLayer(marker);
    data.parking.push({ lat, lng, props, type: 'parking', category });
  }

  // Add ÖPNV marker
  function addOEPNVMarker(feature) {
    const [lng, lat] = feature.geometry.coordinates;
    const props = feature.properties || {};

    const color = '#10b981';
    const marker = createMarker([lat, lng], color, '🚍');
    const popup = createOEPNVPopup(props, lat, lng);
    marker.bindPopup(popup);

    clusters.oepnv.addLayer(marker);
    data.oepnv.push({ lat, lng, props, type: 'oepnv' });
  }

  // Helper functions
  function getGastroIcon(amenity) {
    const icons = {
      restaurant: '🍽️', cafe: '☕', fast_food: '🍔',
      bar: '🍺', pub: '🍺', ice_cream: '🍦', biergarten: '🌳'
    };
    return icons[amenity] || '🍽️';
  }

  function getParkingCategory(props) {
    if (props.amenity === 'bicycle_parking') return 'bicycle_parking';
    if (props.parking === 'multi-storey') return 'multi-storey';
    if (props.access === 'private') return 'private';
    if (props.fee === 'yes') return 'public_paid';
    return 'public_free';
  }

  // Create popups
  function createWCPopup(props, lat, lng) {
    const name = props.name || 'WC';
    const access = props.access === 'customers' ? '🟡 Nur für Kunden' : '🟢 Öffentlich';
    const fee = props.fee === 'yes' ? '💰 Kostenpflichtig' : props.fee === 'no' ? '✓ Kostenlos' : '';
    const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=walking`;

    return `
      <div class="popup-header">🚻 ${name}</div>
      <div class="popup-body">
        <p>${access}</p>
        ${fee ? `<p>${fee}</p>` : ''}
      </div>
      <div class="popup-actions">
        <a href="${mapsUrl}" target="_blank" rel="noopener" class="popup-btn popup-btn-primary">
          📍 Route (Maps)
        </a>
      </div>
    `;
  }

  function createGastroPopup(props, lat, lng) {
    const name = props.name || 'Gastronomie';
    const type = getGastroLabel(props.amenity);
    const cuisine = props.cuisine ? `🍴 ${props.cuisine}` : '';
    const outdoor = props.outdoor_seating === 'yes' ? '🌞 Außensitzplätze' : '';
    const hours = props.opening_hours ? `🕐 ${props.opening_hours}` : '';
    const website = props.website || props.contact_website || props['contact:website'] || '';
    const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=walking`;

    let buttons = `<a href="${mapsUrl}" target="_blank" rel="noopener" class="popup-btn popup-btn-primary">📍 Route</a>`;
    if (website) {
      buttons += `<a href="${website}" target="_blank" rel="noopener" class="popup-btn popup-btn-secondary">🌐 Website</a>`;
    }

    return `
      <div class="popup-header">${name}</div>
      <div class="popup-body">
        <p>${type}</p>
        ${cuisine ? `<p>${cuisine}</p>` : ''}
        ${outdoor ? `<p>${outdoor}</p>` : ''}
        ${hours ? `<p>${hours}</p>` : ''}
      </div>
      <div class="popup-actions">
        ${buttons}
      </div>
    `;
  }

  function createParkingPopup(props, lat, lng) {
    const name = props.name || 'Parkplatz';
    const type = props.amenity === 'bicycle_parking' ? '🚲 Fahrradparkplatz' : '🅿️ Auto-Parkplatz';
    const capacity = props.capacity ? `🚗 ${props.capacity} Plätze` : '';
    const fee = props.fee === 'yes' ? '💰 Kostenpflichtig' : props.fee === 'no' ? '✓ Kostenlos' : '';
    const access = props.access === 'private' ? '🔒 Privat' : props.access === 'customers' ? '🔒 Nur Kunden' : '';
    const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=driving`;

    return `
      <div class="popup-header">${name}</div>
      <div class="popup-body">
        <p>${type}</p>
        ${capacity ? `<p>${capacity}</p>` : ''}
        ${fee ? `<p>${fee}</p>` : ''}
        ${access ? `<p>${access}</p>` : ''}
      </div>
      <div class="popup-actions">
        <a href="${mapsUrl}" target="_blank" rel="noopener" class="popup-btn popup-btn-primary">
          📍 Route (Auto)
        </a>
      </div>
    `;
  }

  function createOEPNVPopup(props, lat, lng) {
    const name = props.name || 'Haltestelle';
    const ref = props.ref ? `#${props.ref}` : '';
    const isBus = props.bus === true || props.bus === 'yes';
    const isTram = props.tram === true || props.tram === 'yes';

    let types = [];
    if (isBus) types.push('🚌 Bus');
    if (isTram) types.push('🚊 Tram');
    const typeLabel = types.length > 0 ? types.join(' · ') : '🚍 ÖPNV';

    const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=walking`;
    const vbbUrl = `https://www.vbb.de/fahrplan/?origin=${lat},${lng}`;

    return `
      <div class="popup-header">🚍 ${name} ${ref}</div>
      <div class="popup-body">
        <p>${typeLabel}</p>
      </div>
      <div class="popup-actions">
        <a href="${vbbUrl}" target="_blank" rel="noopener" class="popup-btn popup-btn-primary">
          📱 VBB-App
        </a>
        <a href="${mapsUrl}" target="_blank" rel="noopener" class="popup-btn popup-btn-secondary">
          📍 Route
        </a>
      </div>
    `;
  }

  function getGastroLabel(amenity) {
    const labels = {
      restaurant: '🍽️ Restaurant', cafe: '☕ Café', fast_food: '🍔 Imbiss',
      bar: '🍺 Bar', pub: '🍺 Pub', ice_cream: '🍦 Eiscafé', biergarten: '🌳 Biergarten'
    };
    return labels[amenity] || '🍽️ Gastronomie';
  }

  // Filter button handlers
  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const layer = btn.dataset.layer;
      activeFilters[layer] = !activeFilters[layer];
      btn.classList.toggle('active');
      btn.setAttribute('aria-pressed', activeFilters[layer]);

      // Toggle gastro subfilter panel
      if (layer === 'gastro') {
        gastroSubfilter.classList.toggle('open', activeFilters.gastro);
      }

      updateMapLayers();
    });
  });

  // Gastro subfilter handlers
  gastroSubCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', () => {
      const amenity = checkbox.dataset.amenity;
      gastroSubFilters[amenity] = checkbox.checked;
      if (activeFilters.gastro) {
        updateGastroMarkers();
      }
    });
  });

  // Initialize with gastro subfilter open
  if (activeFilters.gastro) {
    gastroSubfilter.classList.add('open');
  }

  // Locate user
  function locateUser() {
    if (!navigator.geolocation) {
      alert('Geolocation wird von deinem Browser nicht unterstützt.');
      return;
    }

    btnLocate.disabled = true;
    btnLocate.textContent = '⏳ Suche...';

    navigator.geolocation.getCurrentPosition(
      position => {
        userPos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        if (userMarker) {
          map.removeLayer(userMarker);
        }

        userMarker = L.circleMarker([userPos.lat, userPos.lng], {
          radius: 10,
          fillColor: '#ef4444',
          color: '#fff',
          weight: 3,
          opacity: 1,
          fillOpacity: 0.9
        }).addTo(map);

        userMarker.bindPopup('<strong>📍 Dein Standort</strong>').openPopup();
        map.setView([userPos.lat, userPos.lng], 16);

        btnNearestWC.disabled = false;
        btnNearestGastro.disabled = false;
        if (activeFilters.parking) btnNearestParking.disabled = false;
        btnLocate.textContent = '✓ Standort aktiv';
        btnLocate.disabled = false;
      },
      error => {
        btnLocate.disabled = false;
        btnLocate.textContent = '📍 Standort nutzen';
        let message = 'Standortzugriff fehlgeschlagen. ';
        switch(error.code) {
          case error.PERMISSION_DENIED:
            message += 'Bitte erlaube Standortzugriff.';
            break;
          case error.POSITION_UNAVAILABLE:
            message += 'Standort nicht verfügbar.';
            break;
          case error.TIMEOUT:
            message += 'Zeitüberschreitung.';
            break;
        }
        alert(message);
      },
      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
    );
  }

  // Find nearest location
  function findNearest(type) {
    if (!userPos) return null;
    const locations = data[type];
    if (!locations || locations.length === 0) return null;

    let nearest = null;
    let minDist = Infinity;

    locations.forEach(loc => {
      const dist = getDistance(userPos.lat, userPos.lng, loc.lat, loc.lng);
      if (dist < minDist) {
        minDist = dist;
        nearest = loc;
      }
    });

    return nearest;
  }

  // Calculate distance (Haversine formula)
  function getDistance(lat1, lng1, lat2, lng2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLng = (lng2 - lng1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLng/2) * Math.sin(dLng/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }

  // Navigate to nearest
  function navigateToNearest(type) {
    if (!userPos) return;

    const nearest = findNearest(type);
    if (!nearest) {
      const labels = { wc: 'WC', gastro: 'Restaurant', parking: 'Parkplatz' };
      alert(`Kein${type === 'gastro' ? '' : 'e'} ${labels[type]} gefunden.`);
      return;
    }

    const origin = `${userPos.lat},${userPos.lng}`;
    const destination = `${nearest.lat},${nearest.lng}`;
    const travelMode = type === 'parking' ? 'driving' : 'walking';
    const url = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}&travelmode=${travelMode}`;

    window.open(url, '_blank', 'noopener,noreferrer');
  }

  // Event Listeners
  btnLocate.addEventListener('click', locateUser);
  btnNearestWC.addEventListener('click', () => navigateToNearest('wc'));
  btnNearestGastro.addEventListener('click', () => navigateToNearest('gastro'));
  btnNearestParking.addEventListener('click', () => navigateToNearest('parking'));

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initMap();
      loadAllData();
    });
  } else {
    initMap();
    loadAllData();
  }
})();
</script>

</body>
</html>